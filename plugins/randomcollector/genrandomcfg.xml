<?xml version="1.0"?>
<!--
   Copyright (C) 2003  Stanislav Sinyagin

   This program is free software; you can redistribute it and/or modify
   it under the terms of the GNU General Public License as published by
   the Free Software Foundation; either version 2 of the License, or
   (at your option) any later version.

   This program is distributed in the hope that it will be useful,
   but WITHOUT ANY WARRANTY; without even the implied warranty of
   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
   GNU General Public License for more details.

   You should have received a copy of the GNU General Public License
   along with this program; if not, write to the Free Software
   Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.

  $Id$
  Stanislav Sinyagin <ssinyagin@yahoo.com>

-->

 <!--
   File with a number of random collectors for performance testing.
  -->

<configuration>
<creator-info>
   This file is generated by
   [%creator%]
   on [%timestamp%].
</creator-info>

<token-sets>
  <token-set name="max-limits">
    <param name="comment" value="Maximum limits violations" />
  </token-set>
  <token-set name="min-limits">
    <param name="comment" value="Minimum limits violations" />
  </token-set>
</token-sets>

<monitors>
  <action name="graph-maxlimits">
    <param name="action-type" value="tset" />
    <param name="tset-name" value="max-limits" />
  </action>
  <action name="graph-minlimits">
    <param name="action-type" value="tset" />
    <param name="tset-name" value="min-limits" />
  </action>

  <monitor name="strict-maximum">
    <param name="monitor-type" value="expression" />
    <param name="rpn-expr">
      #max,GT
    </param>
    <param name="action" value="graph-maxlimits" />
    <param name="expires" value="600" />
    <param name="comment"
           value="Value is more than specified maximum" />
  </monitor>

  <monitor name="strict-minimum">
    <param name="monitor-type" value="expression" />
    <param name="rpn-expr">
      #min,LT
    </param>
    <param name="action" value="graph-minlimits" />
    <param name="expires" value="600" />
    <param name="comment"
           value="Value is less than specified minimum" />
  </monitor>
</monitors>

<datasources>

  <subtree name="[% subtree %]">

    <param name="ds-type" value="collector" />
    <param name="collector-type" value="random" />
    <param name="collector-period" value="180" />    
    <param name="collector-timeoffset" value="0" />
    
    <param name="collector-timeoffset-hashstring" value="%data-file%" />
    <param name="collector-timeoffset-min" value="0" />
    <param name="collector-timeoffset-max" value="180" />
    <param name="collector-timeoffset-step" value="60" />
  
    <param name="collector-instance-hashstring" value="%data-file%" />

        <!-- Default schedule for the monitor -->
    <param name="monitor-period"     value="300" />
    <param name="monitor-timeoffset" value="75" />
    
    <param name="storage-type" value="rrd" />
    <param name="data-dir" value="[% datadir %]" />

    <param name="rrd-create-rra">
      RRA:AVERAGE:0.5:1:10080
      RRA:AVERAGE:0.5:60:720      RRA:MAX:0.5:60:720
      RRA:AVERAGE:0.5:1440:732    RRA:MAX:0.5:1440:732
    </param>

    <param name="rrd-create-heartbeat" value="300"/>
    <param name="rrd-create-min" value="U"/>
    <param name="rrd-create-max" value="U"/>

    <param name="leaf-type" value="rrd-def" />
    <param name="rrd-cf"    value="AVERAGE" />
    <param name="rrd-create-dstype" value="GAUGE" />

[% FOREACH sname = T.keys.sort %]
    <subtree name="[% sname %]">
      <param name="comment">
        bl-height=[%T.$sname.params.rnd_baseline_height%],
        bl-period=[%T.$sname.params.rnd_baseline_period%],
        bl-offset=[%T.$sname.params.rnd_baseline_offset%]
      </param>

      <param name="rnd-baseline-type" value="sin" />
      <param name="rnd-baseline-height"
             value="[%T.$sname.params.rnd_baseline_height%]" />
      <param name="rnd-baseline-period"
             value="[%T.$sname.params.rnd_baseline_period%]" />
      <param name="rnd-baseline-offset"
             value="[%T.$sname.params.rnd_baseline_offset%]" />

      <param name="data-file" value="[% fnameprefix _ sname %].rrd" />

[%   FOREACH lname = T.$sname.leaves.keys.sort %]

      <leaf name="[% lname %]">
        <param name="comment">
 baseline-amplitude=[%T.$sname.leaves.$lname.params.rnd_baseline_amplitude%],
 amplitude=[%T.$sname.leaves.$lname.params.rnd_amplitude%]
        </param>

        <param name="legend">
          baseline-height: [%T.$sname.params.rnd_baseline_height%];
          baseline-period: [%T.$sname.params.rnd_baseline_period%];
          baseline-offset: [%T.$sname.params.rnd_baseline_offset%];
          baseline-amplitude:
          [%T.$sname.leaves.$lname.params.rnd_baseline_amplitude%];
          amplitude:       [%T.$sname.leaves.$lname.params.rnd_amplitude%]
        </param>

        <param name="rnd-baseline-amplitude"
          value="[%T.$sname.leaves.$lname.params.rnd_baseline_amplitude%]" />
        <param name="rnd-amplitude"
          value="[%T.$sname.leaves.$lname.params.rnd_amplitude%]" />

        <param name="rrd-ds"    value="[% lname %]" />

        <param name="monitor" value="strict-maximum, strict-minimum" />
        <param name="monitor-vars" value="min=-80000;max=80000"/>
        <param name="monitor-action-target" value="Summary"/>

        <param name="lower-limit" value="[%
          T.$sname.params.rnd_baseline_height -
          T.$sname.leaves.$lname.params.rnd_baseline_amplitude -
          T.$sname.leaves.$lname.params.rnd_amplitude * 0.8 %]"/>
        <param name="upper-limit" value="[%
          T.$sname.params.rnd_baseline_height +
          T.$sname.leaves.$lname.params.rnd_baseline_amplitude +
          T.$sname.leaves.$lname.params.rnd_amplitude * 0.8 %]"/>
        <param name="normal-level" value="[%
          T.$sname.params.rnd_baseline_height %]"/>
      </leaf>

[%   END %]

     <leaf name="Summary">
       <param name="comment">Summary of all leaves in [%sname%]</param>
       <param name="ds-type" value="rrd-multigraph" />
       <param name="ds-names" value="[%T.$sname.leaves.keys.sort.join(',')%]"/>
[%   FOREACH lname = T.$sname.leaves.keys.sort %]
       <param name="ds-expr-[%lname%]"      value="{[%lname%]}" />
       <param name="graph-legend-[%lname%]" value="[%lname%]" />
       <param name="line-style-[%lname%]"   value="LINE1" />
       <param name="line-color-[%lname%]"   value="[%color(lname)%]" />
       <param name="line-order-[%lname%]"   value="[%order(lname)%]" />
[%   END %]
     </leaf>

    </subtree>
    
[% END %]

  </subtree>
</datasources>

</configuration>
