<?xml version="1.0"?>
<!--
   Copyright (C) 2002  Stanislav Sinyagin

   This program is free software; you can redistribute it and/or modify
   it under the terms of the GNU General Public License as published by
   the Free Software Foundation; either version 2 of the License, or
   (at your option) any later version.

   This program is distributed in the hope that it will be useful,
   but WITHOUT ANY WARRANTY; without even the implied warranty of
   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
   GNU General Public License for more details.

   You should have received a copy of the GNU General Public License
   along with this program; if not, write to the Free Software
   Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307, USA.

  $Id$
  Stanislav Sinyagin <ssinyagin@yahoo.com>

-->

<!--
  This example shows how to use Torrus together with the data files
  generated by "http://carrierin.sourceforge.net/".
  CarrierIn.pm is an add-on module for FlowScan Netflow analyser.

  In the example below, the following RRD files are integrated into Torrus:

    exporter_[ip_address]_total.rrd
      total traffic per router

    exporter_[ip_address]_[if_index].rrd
      netflow statistics per router interface

    total.rrd
      all netflow traffic from all sources

  The files are generated and updated by Flowscan process,
  and Torrus is set up to view and monitor those RRD data.
-->

<configuration>

<!-- The definition of data sources follows -->
<datasources>

  <!-- Many of our RRDs have the field "bits" - let's define it here -->
  <template name="bps">
    <leaf name="bps">
      <param name="comment" value="Bits per second" />
      <param name="leaf-type" value="rrd-def" />
      <param name="rrd-ds" value="bits" />
      <param name="rrd-cf" value="AVERAGE" />
      <param name="monitor">
        hw-failures,
        mon-devel,
        high-jumps
      </param>
    </leaf>
  </template>

  <!-- This is the first child of the tree root -->
  <subtree name="Netflow">
    <param name="ds-type" value="rrd-file" />
    <param name="comment"
           value="Netfow data collected by FlowScan with CarrierIn.pm" />

    <!-- All Flowscan-generated files reside here -->
    <param name="data-dir" value="/var/local/flowscan/graphs" />

    <!-- CarrierIn.pm makes RRDs with Holt-Winters forecasting -->
    <param name="rrd-hwpredict" value="enabled" />

    <subtree name="Exporters">
      <param name="comment" value="Netflow exporting devices" />

      <!-- All netflow exporters look the same from here -->
      <filepattern type="subtree" name="$1" filere="exporter_(.*)_total\.rrd">
        <param name="comment" value="" />

        <!-- And here we describe the difference -->
        <detailed match="62.2.3.224">
          <!-- Let's give it a nicer name -->
          <alias>/Netflow/ExportersByName/rtrTelehouse1/</alias>
          <!-- And give all the paramal details if needed -->
          <param name="location" value="Telehouse Street 1, New Yourk" />
          <param name="contact" value="John Smith" />
          <param name="phone" value="+1-800-444555" />
          <subtree name="if11">
              <param name="comment" value="France Telecom 1" />
              <param name="phone" value="+1-800-666555" />
              <!-- We can give it a name from different subtree -->
              <alias>/Netflow/Peering/FranceTelecom-1/</alias>
          </subtree>
        </detailed>

        <!-- Again, on each router, the interfaces look the same -->
        <filepattern type="subtree" name="'if'.$1"
                     filere="exporter_$PARENT_(\d.*)\.rrd">
            <param name="comment" value="Netflow exporting interface" />

            <!-- For each of the interfaces, the bps leaf is taken from the
                 template above -->
            <apply-template name="bps" />
        </filepattern>
      </filepattern>

    </subtree>

    <subtree name="BGP">
      <param name="precedence" value="200"/>
    </subtree>

    <subtree name="Subnets">
      <param name="precedence" value="100"/>
    </subtree>

    <subtree name="Protocols">
    </subtree>

    <!-- Here we have not only a RRD DS, but also a formula -->
    <subtree name="Total">
      <param name="data-file" value="total.rrd" />
      <param name="legend" value="Location:Zurich; Telephone: 01 9911299" />
      <apply-template name="bps" />
      <leaf name="pps">
        <param name="comment" value="Packets per second" />
        <param name="leaf-type" value="rrd-def" />
        <param name="rrd-ds" value="pkts" />
        <param name="rrd-cf" value="AVERAGE" />
      </leaf>
      <leaf name="packlen">
        <param name="comment" value="Average packet length in bytes" />
        <param name="leaf-type" value="rrd-cdef" />
        <param name="rpn-expr" value="{bps},8,/,{pps},/" />
        <param name="monitor" value="high-jumps" />
      </leaf>
    </subtree>
  </subtree>
</datasources>

</configuration>
