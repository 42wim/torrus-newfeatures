<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>RRFW Working Draft: Monitor escalation levels</title>
<link rel="stylesheet" href="../torrusdoc.css" type="text/css" />
<link rev="made" href="mailto:gerrit@familiehaase.de" />
</head>

<body>

<p><a name="__index__"></a></p>
<!-- INDEX BEGIN -->

<ul>

	<li><a href="#rrfw_working_draft__monitor_escalation_levels">RRFW Working Draft: Monitor escalation levels</a></li>
	<ul>

		<li><a href="#introduction">Introduction</a></li>
		<li><a href="#monitor_events">Monitor events</a></li>
		<li><a href="#monitor_parameters">Monitor parameters</a></li>
		<li><a href="#action_parameters">Action parameters</a></li>
		<li><a href="#implementation">Implementation</a></li>
	</ul>

	<li><a href="#author">Author</a></li>
</ul>
<!-- INDEX END -->

<hr />
<p>
</p>
<h1><a name="rrfw_working_draft__monitor_escalation_levels">RRFW Working Draft: Monitor escalation levels</a></h1>
<p>Status: pending implementation.
Date: Nov 5 2003. Last revised: Nov 10 2003</p>
<p>
</p>
<h2><a name="introduction">Introduction</a></h2>
<p>The initial idea comes from Francois Mikus in Cricket development team.
His proposal was to raise the alarm only after several true consecutive
monitor conditions.</p>
<p>The idea has developed into the concept of escalation levels.</p>
<p>
</p>
<h2><a name="monitor_events">Monitor events</a></h2>
<p>Current implementation supports four types of monitor events: <code>set</code>,
<code>repeat</code>, <code>clear</code>, and <code>forget</code>. New event type will be <code>escalate(X)</code>.
<code>X</code> designates a symbolic name for a certain escalation level. Each level
is associated with the escalation time interval.</p>
<p>Given <code>Te</code> as the escalation interval, <code>Ta</code> as the monitor condition age,
and <code>P</code> as period, the escalation event will occur simultaneously with
one of <code>repeat</code> events, when the following condition is true:</p>
<pre>
  Te &gt;= Ta</pre>
<p>New event types <code>clear(X)</code> and <code>forget(X)</code> will occur at the same
time as <code>clear</code> and <code>forget</code> respectively,
for each escalated level.</p>
<p>
</p>
<h2><a name="monitor_parameters">Monitor parameters</a></h2>
<p>New parameter will be introduced: <code>escalation</code>. Value will
be a comma-separated list of <code>name=interval</code> parts, where <code>name</code>
designates the escalation level, and <code>interval</code> specifies the escalation
interval in seconds.</p>
<p>Example:</p>
<pre>
  &lt;monitor name=&quot;rate-limits&quot;&gt;
    &lt;param name=&quot;escalation value=&quot;Medium=1800, High=7200, Critical=14400&quot; /&gt;
    ...
  &lt;/monitor&gt;</pre>
<p>Another example would be Cisco TAC style priorities: P3, P2, P1.</p>
<p>
</p>
<h2><a name="action_parameters">Action parameters</a></h2>
<p><code>launch-when</code> parameter will be valid not for <code>exec</code> actions only, but also
for <code>tset</code> actions. New valid values will be <code>escalate(X)</code>, <code>clear(X)</code>,
and <code>forget(X)</code>.</p>
<p>XML configuration validator will not verify if escalation levels in
action definition match those in datasource configuration.</p>
<p>New optional action parameter: <code>allowed-time</code>. Contains an RPN expression
which must be true at the time when the action is allowed to execute.
Two new RPN functions may be used here: <code>TOD</code> and <code>DOW</code>.</p>
<p><code>TOD</code> returns the current time of day as integer: <code>HH*100+MM</code>. For example,
830 means 8:30 AM, and 1945 means 7:45 PM.</p>
<p><code>DOW</code> returns the current day of the week as integer between and including
0 and 6, with 0 corresponding to Sunday, 1 to Monday, and 6 to Saturday.</p>
<p>In this example, the action is allowed between 8 AM and 6 PM from Monday
to Friday:</p>
<pre>
  &lt;param name=&quot;allowed-time&quot;&gt;
    TOD,800,GE, TOD,1800,LE, AND,
    DOW,1,GE, AND,
    DOW,5,LE, AND
  &lt;/param&gt;</pre>
<p>
</p>
<h2><a name="implementation">Implementation</a></h2>
<p><strong>monitor_alarms.db</strong> database format will change: The values will consist
of five colon-separated fields. The first four fields will be as earilier,
and the fifth one will be a comma-separated list of escalation level names
that have already fired.</p>
<p>The implementation of this feature is preferred after the planned redesign of
the monitor daemon. The new monitor design would support individual
schedule for each datasource leaf, analogous to collector schedules.</p>
<p>In turn, the monitor daemon  redesign is better to do after
the collector daemon redesign. Then it would allow to keep similar design
and architecture where possible.</p>
<p>
</p>
<hr />
<h1><a name="author">Author</a></h1>
<p>Copyright (c) 2003 Stanislav Sinyagin &lt;<a href="mailto:ssinyagin@yahoo.com">ssinyagin@yahoo.com</a>&gt;</p>

</body>

</html>
