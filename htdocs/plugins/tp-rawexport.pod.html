<?xml version="1.0" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Raw Export Collector Plugin</title>
<link rel="stylesheet" href="../torrusdoc.css" type="text/css" />
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rev="made" href="mailto:root@localhost" />
</head>

<body>

<p><a name="__index__"></a></p>
<!-- INDEX BEGIN -->

<ul>

	<li><a href="#raw_export_collector_plugin">Raw Export Collector Plugin</a></li>
	<ul>

		<li><a href="#introduction">Introduction</a></li>
		<li><a href="#installation">Installation</a></li>
		<li><a href="#configuration">Configuration</a></li>
		<li><a href="#example">Example</a></li>
	</ul>

</ul>
<!-- INDEX END -->

<hr />
<p>
</p>
<h1><a name="raw_export_collector_plugin">Raw Export Collector Plugin</a></h1>
<p>
</p>
<h2><a name="introduction">Introduction</a></h2>
<p>The Raw Export plugin implments a new storage type for Torrus.
It allows exporting the raw collected data in plain files.
Currently the counter values are exported without changes, and
in the future there will be support for exporting counter increments.</p>
<p>The data is exported in text form, one datasource per line.
Each line contains three or four fields, separated by the characters defined
by <a href="#item_raw_2dfield_2dseparator"><code>raw-field-separator</code></a> parameter:</p>
<ul>
<li><strong><a name="item_timestamp">Timestamp</a></strong>

<p>The timestamp of the collected data, in format defined
by <a href="#item_raw_2dtimestamp_2dformat"><code>raw-timestamp-format</code></a> parameter.</p>
</li>
<li><strong><a name="item_row_id">Row ID</a></strong>

<p>A text string that identifies the datasource. It is defined by <a href="#item_raw_2drowid"><code>raw-rowid</code></a>
parameter in the datasource leaf.</p>
</li>
<li><strong><a name="item_collected_value">Collected value</a></strong>

<p>If <a href="#item_raw_2dcounter_2dbase"><code>raw-counter-base</code></a> is not defined, the third and the last field contains
the raw value that was collected. It may be a very large integer
in case if the datasource is a 64-bit counter.
The value is set to <code>U</code> in the event of a counter reset, such as
when a monitored device is rebooted.</p>
<p>If <a href="#item_raw_2dcounter_2dbase"><code>raw-counter-base</code></a> is set to <code>32</code> or <code>64</code>, the third field contains the
counter increment, and the fourth field contains the time interval for it.</p>
</li>
<li><strong><a name="item_time_interval">Time interval</a></strong>

<p>The time interval in seconds, if the datasource is exported as a counter.</p>
</li>
</ul>
<p>The raw export files are written by a background thread, leaving the main
thread more time to perform the collecting work. The <code>torrus schedulerinfio</code>
reports the size of the raw update queue in runtime statistics.</p>
<p>
</p>
<h2><a name="installation">Installation</a></h2>
<p>Follow the Torrus installation guide for the main software installation.
This plugin requires the multithreading support in Torrus. It would not
function in a non-multithreaded environment.</p>
<p>Unpack the plugin distribution package in some directory:</p>
<pre>
  gzip -dc tp-rawexport-1.X.tar.gz | tar xvf -</pre>
<p>Then run the Torrus plugin installation utility:</p>
<pre>
  torrus install_plugin tp-rawexport-1.X</pre>
<p>Restart Torrus collector processes.</p>
<p>
</p>
<h2><a name="configuration">Configuration</a></h2>
<p>In order to get use of Raw export, the <code>storage-type</code> parameter should
contain <code>raw</code> as one of the comma-separated values. Usually
<code>storage-type</code> is set to the value <code>raw,rrd</code>.</p>
<p>The following parameters define the raw storage operation:</p>
<ul>
<li><strong><a name="item_raw_2ddatadir"><code>raw-datadir</code></a></strong>

<p>Mandatory, the directory where the raw export files are stored.</p>
</li>
<li><strong><a name="item_raw_2dfile"><code>raw-file</code></a></strong>

<p>Mandatory, the export file name. It can contain any <code>strftime(3)</code> conversion
characters, but the percent sign (<code>%</code>) should be replaced with hash
sign (<code>#</code>).</p>
</li>
<li><strong><a name="item_raw_2dfield_2dseparator"><code>raw-field-separator</code></a></strong>

<p>Mandatory, the field separator inside the export line.</p>
</li>
<li><strong><a name="item_raw_2dtimestamp_2dformat"><code>raw-timestamp-format</code></a></strong>

<p>Mandatory, timestamp format in <code>strftime(3)</code> notation, with the percent sign
(<code>%</code>) replaced with hash sign (<code>#</code>).</p>
</li>
<li><strong><a name="item_raw_2drowid"><code>raw-rowid</code></a></strong>

<p>Mandatory, a string that uniquely identifies the datasource.</p>
</li>
<li><strong><a name="item_raw_2dcounter_2dbase"><code>raw-counter-base</code></a></strong>

<p>Optional. Valid values: <code>32</code> or <code>64</code>.
When defined, it declares the given datasource as a 32- or 64-bit counter.
The stored value is then recorded as a pair (increment, interval) with a
defined field separator.</p>
</li>
<li><strong><a name="item_raw_2dcounter_2dmaxrate"><code>raw-counter-maxrate</code></a></strong>

<p>Optional. If it is defined, it should contain the maximum rate at which
the counter can increment, in units per second. It is used only when
<a href="#item_raw_2dcounter_2dbase"><code>raw-counter-base</code></a> is defined. A counter may accidentally increase to huge
values because of a remote device reset, and this option prevents such
bursts from recording.</p>
</li>
</ul>
<p>
</p>
<h2><a name="example">Example</a></h2>
<p>The following XML template is installed as <em>examples/rawexport-example.xml</em>
by the plugin installer. It provides basic functionality for exporting of
IF-MIB counters. The example refers to a parameter <code>raw-file-suffix</code> which
is not part of this plugin, and is given only as an example. The
discovery instruction (DDX) file listed below defines this parameter at
the host level.</p>
<p>Note that your templates should also declare the parameters as expandable,
as given in the eample below.</p>
<p>It is important that <a href="#item_raw_2dfile"><code>raw-file</code></a> depends on <code>collector-instance</code>. It
ensures that several collector instances for a given tree would never write
to the same file concurrently.</p>
<p>This example stores the data in files that depend on the calendar date.
This makes them convenient to grab for daily processing.
For example, at 3:00 every morning you can move all the files that
are more than 2 hours old for further processing. Also their
alphabetical sorting would list them in temporal order.</p>
<p>File: <em>examples/rawexport-example.xml</em></p>
<pre>
 &lt;configuration&gt;</pre>
<pre>
   &lt;param-properties&gt;
     &lt;prop param=&quot;raw-file&quot;       prop=&quot;expand&quot; value=&quot;1&quot;/&gt;
     &lt;prop param=&quot;raw-rowid&quot;      prop=&quot;expand&quot; value=&quot;1&quot;/&gt;
   &lt;/param-properties&gt;</pre>
<pre>
   &lt;datasources&gt;</pre>
<pre>
     &lt;template name=&quot;raw-defaults-ifoctets-examle&quot;&gt;
  
       &lt;param name=&quot;raw-datadir&quot; value=&quot;/srv/torrus/raw&quot; /&gt;
       &lt;param name=&quot;raw-file&quot;
              value=&quot;#Y-#m-#d.%collector-instance%.%raw-file-suffix%&quot; /&gt;
       &lt;param name=&quot;raw-field-separator&quot; value=&quot;,&quot; /&gt;
       &lt;param name=&quot;raw-timestamp-format&quot; value=&quot;#d#b#Y:#H:#M:#S&quot; /&gt;
       &lt;param name=&quot;raw-rowid&quot; value=&quot;%system-id%,%interface-name%,%rrd-ds%&quot; /&gt;
    
     &lt;/template&gt;
  
   &lt;/datasources&gt;</pre>
<pre>
 &lt;/configuration&gt;</pre>
<p>The following is a fragment of a Devdiscover instructions file (DDX)
which sets up the raw export for input and output byte counters,
for all interfaces whose names start with 'eth':</p>
<pre>
  &lt;host&gt;
    &lt;param name=&quot;snmp-host&quot; value=&quot;mylinuxhost&quot;/&gt;</pre>
<pre>
    &lt;param name=&quot;include-files&quot; value=&quot;examples/rawexport-example.xml&quot;/&gt;
    &lt;param name=&quot;custom-host-templates&quot; value=&quot;raw-defaults-ifoctets-examle&quot;/&gt;
    &lt;param name=&quot;host-copy-params&quot; value=&quot;raw-file-suffix&quot;/&gt;
    &lt;param name=&quot;raw-file-suffix&quot; value=&quot;rawexport&quot;/&gt;</pre>
<pre>
    &lt;param name=&quot;selectors&quot;            value=&quot;raw&quot;/&gt;
    &lt;param name=&quot;raw-selector-type&quot;    value=&quot;RFC2863_IF_MIB&quot;/&gt;
    &lt;param name=&quot;raw-selector-expr&quot;    value=&quot;{ifSubtreeName}&quot;/&gt;
    &lt;param name=&quot;raw-ifSubtreeName&quot;    value=&quot;^eth&quot;/&gt;
    &lt;param name=&quot;raw-selector-actions&quot;
                             value=&quot;InBytesParameters,OutBytesParameters&quot;/&gt;
    &lt;param name=&quot;raw-InBytesParameters-arg&quot;&gt;
      storage-type=raw,rrd;
      raw-counter-base=64;
      raw-counter-maxrate=1e15
    &lt;/param&gt;
    &lt;param name=&quot;raw-OutBytesParameters-arg&quot;&gt;
      storage-type=raw,rrd;
      raw-counter-base=64;
      raw-counter-maxrate=1e15
    &lt;/param&gt;
  &lt;/host&gt;</pre>

</body>

</html>
