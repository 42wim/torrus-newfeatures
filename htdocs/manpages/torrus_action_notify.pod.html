<?xml version="1.0" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>action_notify - Generic notification handler for Torrus monitor</title>
<link rel="stylesheet" href="../torrusdoc.css" type="text/css" />
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rev="made" href="mailto:root@localhost" />
</head>

<body>

<p><a name="__index__"></a></p>
<!-- INDEX BEGIN -->
<!--

<ul>

	<li><a href="#name">NAME</a></li>
	<li><a href="#synopsis">SYNOPSIS</a></li>
	<li><a href="#description">DESCRIPTION</a></li>
	<li><a href="#files">FILES</a></li>
	<li><a href="#see_also">SEE ALSO</a></li>
	<li><a href="#notes">NOTES</a></li>
	<li><a href="#author">AUTHOR</a></li>
</ul>
-->
<!-- INDEX END -->

<p>
</p>
<h1><a name="name">NAME</a></h1>
<p>action_notify - Generic notification handler for Torrus monitor</p>
<p>
</p>
<hr />
<h1><a name="synopsis">SYNOPSIS</a></h1>
<pre>
 &lt;action name=&quot;notify&quot;&gt;
   &lt;param name=&quot;action-type&quot; value=&quot;exec&quot; /&gt;
   &lt;param name=&quot;command&quot;&gt;
     $TORRUS_BIN/action_notify
   &lt;/param&gt;
   &lt;param name=&quot;launch-when&quot; value=&quot;set&quot; /&gt;
 &lt;/action&gt;</pre>
<p>
</p>
<hr />
<h1><a name="description">DESCRIPTION</a></h1>
<p>This program is designed for usage from a monitor action only. It takes
the arguments from environment variables, as described in action-type
<code>exec</code> in <strong>Torrus XML Configuration Guide</strong>.</p>
<p>The handler reads its configuration from &lt;notify-siteconfig.pl&gt;, a small
Perl file which defines the notification paths for various conditions.</p>
<p>Example:</p>
<pre>
  %Torrus::Notify::programs =
    (
     'mailto' =&gt; '$TORRUS_BIN/action_printemail | /usr/bin/mail $ARG1',
     'page' =&gt; '/usr/bin/echo $TORRUS_NODEPATH:$TORRUS_MONITOR ' .
     '&gt;&gt; /tmp/monitor.$ARG1.log'
     );</pre>
<pre>
  %Torrus::Notify::policies =
    (
     'CUST_A' =&gt; {
         'match' =&gt; sub { $ENV{'TORRUS_P_notify_policy'} eq 'A' },
         'severity' =&gt; {
             '3' =&gt; [ '<a href="mailto:aaa@domain.com">mailto:aaa@domain.com</a>',
                      '<a href="mailto:bbb@domain.com">mailto:bbb@domain.com</a>' ],
             '5' =&gt; [ 'page:1234', '<a href="mailto:boss@domain.com">mailto:boss@domain.com</a>' ] } } );</pre>
<p>In this example, we define two message handlers: e-mail sender and
a dummy replacement for a pager program. Then we define the notification
policies. For the customer <em>A</em>, we define the policy so that
the parameter <code>notify-policy</code> should match the name <code>A</code>. The parameter
is defined in the datasource tree and marks only those leaves
that belong to this customer.
Then, depending on the monitor severity, different notification
paths are defined. For severity values higher or equal 3, <a href="mailto:aaa@domain.com">aaa@domain.com</a> and
<a href="mailto:bbb@domain.com">bbb@domain.com</a> will receive the email notifications, and for severity
higher than or equal 5 all recipients will receive the notification.</p>
<p>The <code>match</code> argument is a Perl subroutine, and can depend on various
parameters, such as time of day or day of the week, the tree name, and so on.</p>
<p>
</p>
<hr />
<h1><a name="files">FILES</a></h1>
<dl>
<dt><strong><a name="item__2fusr_2flocal_2fetc_2ftorrus_2fconf_2fnotify_2dsi"><em>/usr/local/etc/torrus/conf/notify-siteconfig.pl</em></a></strong>

<dd>
<p>Notification policies configuration</p>
</dd>
</li>
</dl>
<p>
</p>
<hr />
<h1><a name="see_also">SEE ALSO</a></h1>
<p><em>torrus(1)</em></p>
<p>
</p>
<hr />
<h1><a name="notes">NOTES</a></h1>
<p>See more documentation at Torrus home page: <a href="http://torrus.org">http://torrus.org</a></p>
<p>
</p>
<hr />
<h1><a name="author">AUTHOR</a></h1>
<p>Stanislav Sinyagin &lt;<a href="mailto:ssinyagin@yahoo.com">ssinyagin@yahoo.com</a>&gt;</p>

</body>

</html>
