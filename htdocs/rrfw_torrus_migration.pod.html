<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>RRFW to Torrus migration guide</title>
<link rel="stylesheet" href="torrusdoc.css" type="text/css" />
<link rev="made" href="mailto:gp@familiehaase.de" />
</head>

<body>

<p><a name="__index__"></a></p>
<!-- INDEX BEGIN -->

<ul>

	<li><a href="#rrfw_to_torrus_migration_guide">RRFW to Torrus migration guide</a></li>
	<ul>

		<li><a href="#introduction">Introduction</a></li>
		<li><a href="#software_installation">Software installation</a></li>
		<li><a href="#the_perl_configuration_files">The Perl configuration files</a></li>
		<li><a href="#xml_configuration_files">XML configuration files</a></li>
		<li><a href="#monitor_actions">Monitor actions</a></li>
		<li><a href="#snmp_discovery_files">SNMP discovery files</a></li>
		<li><a href="#web_interface_acls">Web interface ACLs</a></li>
		<li><a href="#sitespecific_text_templates">Site-specific text templates</a></li>
		<li><a href="#apache_configuration">Apache configuration</a></li>
		<li><a href="#stop_rrfw_collector_and_monitor_processes">Stop RRFW collector and monitor processes</a></li>
		<li><a href="#change_the_rrd_files_ownership">Change the RRD files ownership</a></li>
		<li><a href="#test_and_run_processes">Test and run processes</a></li>
		<li><a href="#update_the_cron_jobs">Update the cron jobs</a></li>
		<li><a href="#update_documentation">Update documentation</a></li>
	</ul>

	<li><a href="#author">Author</a></li>
</ul>
<!-- INDEX END -->

<hr />
<p>
</p>
<h1><a name="rrfw_to_torrus_migration_guide">RRFW to Torrus migration guide</a></h1>
<p>
</p>
<h2><a name="introduction">Introduction</a></h2>
<p>Torrus is the new marketing name for RRFW (Round-robin Database Framework),
a robust and flexible software package for data series processing.
The last release of RRFW is 0.1.8. The upcoming release 1.0.0 of Torrus
will introduce some significant changes and design improvements.</p>
<p>The directory structure of Torrus is more standards-compliant, and more
convenient for system adminisrators. The user files are strictly separated
from the distribution files. The XML configurations and HTML templates
are being searched in multiple directories, thus there will be no longer a
mixture of site-specific files with the ones from distribution.</p>
<p>In addition, Torrus introduces a commandline wrapper that is installed in
a generic directory for user executables (by default, <em>/usr/local/bin</em>).
This greatly simplifies the site administrator's tasks.</p>
<p>The plugins infrastructure is completely redesigned.
The plugin installation procedure is separated from the main software
installation. In addition, plugin installers set up their initialization
scripts in special directories, so that there's no need for plugin
initialization in <em>torrus-siteconfig.pl</em> and other files.</p>
<p>Further on, we assume that RRFW is installed in its default directory,
<em>/usr/local/rrfw-0.1</em>, and Torrus is installed with default paths.
We refer to TORRUS_DISTR as the unpacked Torrus distribution path.</p>
<p>
</p>
<h2><a name="software_installation">Software installation</a></h2>
<p>Create a new user: <code>torrus</code> and group: <code>torrus</code>. The user ID that is
used by Apache process must be a member of this group. Depending on the
system, this user may be named as <code>www</code>, <code>httpd</code>, <code>nobody</code> etc. Consult
your Apache configuration for details.</p>
<p>Install Torrus. If your system already runs RRFW release 0.1.8,
all prerequisites should be already in place. Then you simply unpack
the Torrus distribution, and from its directory execute</p>
<pre>
  ./configure
  make install</pre>
<p>If required, download and unpack the Torrus plugins. Then for each plugin,
execute</p>
<pre>
  torrus install_plugin &lt;UNPACKED_PLUGIN_DIR&gt;</pre>
<p>
</p>
<h2><a name="the_perl_configuration_files">The Perl configuration files</a></h2>
<p>Te distribution contains a short Shell script called
<code>TORRUS_DISTR/setup_tools/replace_rrfw.sh</code>. This script takes one file name
as an argument, replaces all occurrences of <em>RRFW</em> to <em>Torrus</em> and <em>rrfw</em>
to <em>torrus</em>, and finally replaces the specified file with the new one.</p>
<p>Copy the site configuration files from RRFW to Torrus directory:</p>
<pre>
  cd /usr/local/etc/torrus/
  cp /usr/local/rrfw-0.1/share/rrfw/rrfw-siteconfig.pl \
    conf/torrus-siteconfig.pl
  TORRUS_DISTR/setup_tools/replace_rrfw.sh conf/torrus-siteconfig.pl</pre>
<p>If needed, follow the same procedure for <em>devdiscover-siteconfig.pl</em>
and other site configs.</p>
<p>
</p>
<h2><a name="xml_configuration_files">XML configuration files</a></h2>
<p>The format of XML fles has not changed, so you simply copy
all locally defined files into <em>/usr/local/etc/torrus/xmlconfig</em>.</p>
<p>The following Shell commands might be of help. They copy all XML files that
do not occur in <em>/usr/local/torrus/xmlconfig</em>, the default path for
distribution supplied files:</p>
<pre>
  cd /usr/local/rrfw-0.1/share/rrfw/xmlconfig/
  find . -name '*.xml' -exec test ! -f /usr/local/torrus/xmlconfig/'{}' ';' \
    -print | cpio --create --file=/tmp/allxml.cpio
  cd /usr/local/etc/torrus/xmlconfig/
  cpio --extract --file=/tmp/allxml.cpio</pre>
<p>After copying XML files, compile them in Torrus:</p>
<pre>
  torrus compilexml --all --verbose</pre>
<p>
</p>
<h2><a name="monitor_actions">Monitor actions</a></h2>
<p>If you utilize the monitor daemon, you will most probably need
to change the action statements.</p>
<p>In the action of type <code>exec</code>, the <code>command</code> parameter should be edited.
RRFW was usually referencing the email notification command as
<em>$RRFW_HOME/bin/action_printemail</em>. In Torrus, this command should be
referred as <em>$TORRUS_BIN/action_printemail</em>.</p>
<p>
</p>
<h2><a name="snmp_discovery_files">SNMP discovery files</a></h2>
<pre>
  cd /usr/local/etc/torrus/
  cp /usr/local/rrfw-0.1/share/rrfw/discovery/*.ddx discovery/</pre>
<p>The treatment of <code>output-file</code> parameter has slightly changed.
In RRFW, relative filename meant relative to the current working directory,
and <code>$XMLCONFIG</code> macro was used for referring the default XML files directory.
In Torrus, <code>$XMLCONFIG</code> is still supported, but it is advisory to get rid
of it. Now the relative filenames refer to the user's XML directory,
<em>/usr/local/torrus/xmlconfig</em>. Absolute filenames are used as they are.</p>
<p>In addition, <code>torrus devdiscover</code> acepts the relative input file names,
and searches for them in <em>/usr/local/torrus/discovery</em>.</p>
<p>
</p>
<h2><a name="web_interface_acls">Web interface ACLs</a></h2>
<pre>
  cd /usr/local/etc/torrus/
  /usr/local/rrfw-0.1/bin/acledit --export=acl.xml
  torrus acledit --import=acl.xml</pre>
<p>
</p>
<h2><a name="sitespecific_text_templates">Site-specific text templates</a></h2>
<p>If you used some custom templates (HTML templates for the Web interface,
or text templates for e-mail notifications), copy them to
<em>/usr/local/etc/torrus/templates</em>. This directory should contain only
your custom templates. Those delivered with the distribution packages are
located in <em>/usr/local/torrus/templates</em>.</p>
<p>
</p>
<h2><a name="apache_configuration">Apache configuration</a></h2>
<p>Follow the Torrus Web interface guide and configure Apache accordingly.
If needed, use the following Apache command to redirect the users which
use the old URL:</p>
<pre>
  Redirect /rrfw <a href="http://host.domain.com/torrus">http://host.domain.com/torrus</a></pre>
<p>After changing the configuration, stop and start Apache.</p>
<p>
</p>
<h2><a name="stop_rrfw_collector_and_monitor_processes">Stop RRFW collector and monitor processes</a></h2>
<p>Depending on your system configuration, the command would look like</p>
<pre>
  /etc/init.d/rrfw stop</pre>
<p>Make sure that all old processes are stopped. Then remove the RRFW startup
script from all rc.d directories.</p>
<p>
</p>
<h2><a name="change_the_rrd_files_ownership">Change the RRD files ownership</a></h2>
<p>Depending on your system configuration, the paths for RRD files might be
different.</p>
<pre>
  chown torrus:torrus /var/snmpcollector/*</pre>
<p>
</p>
<h2><a name="test_and_run_processes">Test and run processes</a></h2>
<p>For testing purposes, you might want to try launching the collector and
monitor processes, as follows:</p>
<pre>
  torrus collector --tree=mytree --runonce --debug</pre>
<p>Then copy the Torrus startup script to your system's init directory and setup
new symbolic links, if required. The following example should work for
Sun Solaris:</p>
<pre>
  cp TORRUS_DISTR/init.d/torrus /etc/init.d
  cd /etc/rc3.d
  ln -s S90torrus ../init.d/torrus
  cd /etc/rc0.d
  ln -s K90torrus ../init.d/torrus</pre>
<p>Run the startup script and verify that RRD files get updated.</p>
<p>
</p>
<h2><a name="update_the_cron_jobs">Update the cron jobs</a></h2>
<p>RRFW's cron job <em>/usr/local/rrfw-0.1/bin/cleanup</em> should be replaced with
the analogous job from Torrus: <em>/usr/local/torrus/bin/cleanup</em></p>
<p>
</p>
<h2><a name="update_documentation">Update documentation</a></h2>
<p>Update your site operational manuals to reflect the new software name,
paths and URLs.</p>
<p>
</p>
<hr />
<h1><a name="author">Author</a></h1>
<p>Copyright (c) 2004 Stanislav Sinyagin &lt;<a href="mailto:ssinyagin@yahoo.com">ssinyagin@yahoo.com</a>&gt;</p>

</body>

</html>
